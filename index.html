<!DOCTYPE html>
<html>
<head>
  <title>Crypto Futures Signal Scanner</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    body {
  background-color: #121212;
  color: #f0f0f0;
  font-family: monospace;
  padding: 1rem;
}
.signal-card {
  border: 1px solid #333;
  border-radius: 12px;
  padding: 10px;
  margin-bottom: 15px;
  background-color: #1e1e1e;
  box-shadow: 0 4px 6px rgba(0,0,0,0.3);
}
.trade-button {
  background-color: #00c853;
  color: white;
  padding: 6px 12px;
  border: none;
  border-radius: 6px;
  margin-top: 8px;
}
.trade-button:hover {
  background-color: #00e676;
  cursor: pointer;
}
#toast {
  visibility: hidden;
  min-width: 200px;
  background-color: #323232;
  color: white;
  text-align: center;
  padding: 10px;
  border-radius: 10px;
  position: fixed;
  z-index: 1;
  left: 50%;
  bottom: 30px;
  transform: translateX(-50%);
}
#toast.show {
  visibility: visible;
  animation: fadein 0.5s, fadeout 0.5s 2.5s;
}
@keyframes fadein { from { bottom: 20px; opacity: 0; } to { bottom: 30px; opacity: 1; } }
@keyframes fadeout { from { bottom: 30px; opacity: 1; } to { bottom: 20px; opacity: 0; } }
  </style>
</head>
<body>
  <h2>Crypto Futures Signal Scanner</h2>
  <button onclick="scan()">Scan Now</button>
  <div id="lastTime" style="margin-bottom:10px;"></div>
  <div id="output">Loading...</div>

  <script>
    const output = document.getElementById("output");
    const lastTime = document.getElementById("lastTime");

    const apiKey = 'YOUR_BINANCE_API_KEY';
    const apiSecret = 'YOUR_BINANCE_API_SECRET';

    async function scan() {
      output.innerHTML = "Scanning...";
      const res = await fetch("https://fapi.binance.com/fapi/v1/ticker/price");
      const coins = await res.json();
      const usdtPairs = coins.filter(c => c.symbol.endsWith("USDT") && !c.symbol.includes("_"));
      const results = await Promise.all(usdtPairs.map(c => analyzeSymbol(c.symbol)));
      const filtered = results.filter(r => r);
      output.innerHTML = filtered.length > 0 ? filtered.join("") : "No strong signals found.";
      lastTime.innerText = "Last scanned: " + new Date().toLocaleTimeString();
    }

    async function analyzeSymbol(symbol) {
      try {
        const url = `https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=15m&limit=100`;
        const res = await fetch(url);
        const data = await res.json();

        const closes = data.map(c => parseFloat(c[4]));
        const volumes = data.map(c => parseFloat(c[5]));

        const ema9 = calculateEMA(closes, 9);
        const ema21 = calculateEMA(closes, 21);
        const rsi = calculateRSI(closes, 14);
        const { macd, signal } = calculateMACD(closes);
        const lastClose = closes[closes.length - 1];
        const lastVol = volumes[volumes.length - 1];
        const avgVol = volumes.slice(-20).reduce((a, b) => a + b, 0) / 20;

        const latestEma9 = ema9[ema9.length - 1];
        const latestEma21 = ema21[ema21.length - 1];
        const latestRsi = rsi[rsi.length - 1];
        const latestMacd = macd[macd.length - 1];
        const latestSignal = signal[signal.length - 1];

        const candleStrength = (lastClose - data[data.length - 1][1]) / lastClose;

        let signalType = null;
        let confidence = "Normal";

        if (
          latestEma9 > latestEma21 &&
          latestRsi > 50 &&
          latestMacd > latestSignal &&
          lastVol > avgVol * 1.2 &&
          candleStrength > 0.002
        ) {
          signalType = "LONG";
          confidence = latestRsi > 60 ? "High" : "Medium";
        } else if (
          latestEma9 < latestEma21 &&
          latestRsi < 50 &&
          latestMacd < latestSignal &&
          lastVol > avgVol * 1.2 &&
          candleStrength < -0.002
        ) {
          signalType = "SHORT";
          confidence = latestRsi < 40 ? "High" : "Medium";
        }

        if (signalType) {
          const price = lastClose;
          const tp = signalType === "LONG" ? (price * 1.03).toFixed(5) : (price * 0.97).toFixed(5);
          const sl = signalType === "LONG" ? (price * 0.98).toFixed(5) : (price * 1.02).toFixed(5);
          const tradeSide = signalType === "LONG" ? "BUY" : "SELL";

          return `
            <div class="signal-block">
              <b>📊 Symbol:</b> ${symbol}<br>
              <b>🚨 SIGNAL:</b> <span class="${signalType === "LONG" ? "long" : "short"}">${signalType}</span><br>
              <b>💰 Entry:</b> ${price.toFixed(4)}<br>
              <b>⭐ TP:</b> ${tp}<br>
              <b>⛔ SL:</b> ${sl}<br>
              <b>⚙️ Leverage:</b> 10–20x<br>
              <b>✅ Confidence:</b> ${confidence}<br>
              <button onclick="placeOrder('${symbol}', '${tradeSide}', ${price.toFixed(4)}, ${tp}, ${sl})">Trade</button>
            </div>
          `;
        }
      } catch (err) {
        console.error("Error analyzing", symbol, err);
        return null;
      }
    }

    function calculateEMA(closes, period) {
      const k = 2 / (period + 1);
      let ema = [closes[0]];
      for (let i = 1; i < closes.length; i++) {
        ema.push(closes[i] * k + ema[i - 1] * (1 - k));
      }
      return ema;
    }

    function calculateRSI(closes, period) {
      let gains = 0, losses = 0;
      for (let i = 1; i <= period; i++) {
        let diff = closes[i] - closes[i - 1];
        if (diff >= 0) gains += diff;
        else losses -= diff;
      }
      let rs = gains / losses;
      let rsi = [100 - 100 / (1 + rs)];

      for (let i = period + 1; i < closes.length; i++) {
        let diff = closes[i] - closes[i - 1];
        if (diff >= 0) {
          gains = (gains * (period - 1) + diff) / period;
          losses = (losses * (period - 1)) / period;
        } else {
          gains = (gains * (period - 1)) / period;
          losses = (losses * (period - 1) - diff) / period;
        }
        rs = gains / losses;
        rsi.push(100 - 100 / (1 + rs));
      }
      return rsi;
    }

    function calculateMACD(closes) {
      const ema12 = calculateEMA(closes, 12);
      const ema26 = calculateEMA(closes, 26);
      const macd = ema12.map((val, i) => val - ema26[i]);
      const signal = calculateEMA(macd.slice(ema26.length - macd.length), 9);
      return { macd: macd.slice(-signal.length), signal };
    }

    function placeOrder(symbol, side, entry, tp, sl) {
  const msg = Placing ${side} order for ${symbol} at ${entry}\nTP: ${tp}\nSL: ${sl};
  console.log(msg);

  // Simulate response
  const success = Math.random() > 0.1; // 90% chance of success

  showToast(success ? ✅ Order placed for ${symbol} : ❌ Failed to place order for ${symbol});
}

function showToast(message) {
  const toast = document.getElementById("toast");
  toast.innerText = message;
  toast.className = "show";
  setTimeout(() => { toast.className = toast.className.replace("show", ""); }, 3000);
}

    scan(); // auto scan on load
  </script>
  <div id="toast"></div>
</body>
</html>
