<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Futures Signal Generator</title>
  <style>
    body {
      background: black;
      font-family: monospace;
      color: #00ff00;
      text-align: center;
      padding: 20px;
    }
    select, button {
      background: black;
      color: #00ff00;
      border: 2px solid #00ff00;
      padding: 10px;
      margin: 10px 0;
      border-radius: 5px;
      font-size: 1em;
      width: 80%;
    }
    #output {
      border: 2px solid #00ff00;
      border-radius: 15px;
      padding: 20px;
      margin-top: 20px;
      background: #111;
      box-shadow: 0 0 15px #00ff00;
    }
  </style>
</head>
<body>

  <h2>Futures Signal Generator</h2>

  <select id="tokenList"></select>
  <button onclick="generateSignal()">Generate 15m Signal</button>

  <div id="output"></div>

  <script>
  let allSymbols = [];

  async function loadSymbols() {
    const res = await fetch("https://fapi.binance.com/fapi/v1/exchangeInfo");
    const data = await res.json();
    allSymbols = data.symbols
      .filter(s => s.quoteAsset === "USDT" && s.contractType === "PERPETUAL" && s.status === "TRADING")
      .map(s => s.symbol)
      .sort();
    const select = document.getElementById("tokenList");
    allSymbols.forEach(sym => {
      const opt = document.createElement("option");
      opt.value = sym;
      opt.textContent = sym;
      select.appendChild(opt);
    });
  }

  async function fetchKlines(symbol) {
    try {
      const url = `https://fapi.binance.com/fapi/v1/klines?symbol=${symbol}&interval=15m&limit=100`;
      const res = await fetch(url);
      const data = await res.json();
      return data.map(d => ({
        close: parseFloat(d[4]),
        high: parseFloat(d[2]),
        low: parseFloat(d[3]),
        volume: parseFloat(d[5])
      }));
    } catch {
      return null;
    }
  }

  function EMA(prices, length) {
    const k = 2 / (length + 1);
    let ema = prices.slice(0, length).reduce((a, b) => a + b) / length;
    const result = [ema];
    for (let i = length; i < prices.length; i++) {
      ema = prices[i] * k + ema * (1 - k);
      result.push(ema);
    }
    return result;
  }

  function RSI(prices, period = 14) {
    let gains = 0, losses = 0;
    for (let i = 1; i <= period; i++) {
      let diff = prices[i] - prices[i - 1];
      if (diff > 0) gains += diff;
      else losses -= diff;
    }
    let avgGain = gains / period;
    let avgLoss = losses / period;
    for (let i = period + 1; i < prices.length; i++) {
      let diff = prices[i] - prices[i - 1];
      if (diff > 0) {
        avgGain = (avgGain * (period - 1) + diff) / period;
        avgLoss = (avgLoss * (period - 1)) / period;
      } else {
        avgGain = (avgGain * (period - 1)) / period;
        avgLoss = (avgLoss * (period - 1) - diff) / period;
      }
    }
    const rs = avgLoss === 0 ? 100 : avgGain / avgLoss;
    return 100 - (100 / (1 + rs));
  }

  function MACD(prices) {
    const ema12 = EMA(prices, 12);
    const ema26 = EMA(prices, 26);
    const macdLine = ema12.slice(-ema26.length).map((val, i) => val - ema26[i]);
    const signalLine = EMA(macdLine, 9);
    const histogram = macdLine.slice(-signalLine.length).map((val, i) => val - signalLine[i]);
    return {
      macdLine: macdLine.at(-1),
      signalLine: signalLine.at(-1),
      histogram: histogram.at(-1)
    };
  }

  async function generateSignal() {
    const output = document.getElementById("output");
    output.innerHTML = "Scanning tokens for strong signals...";

    let signals = "";

    for (const symbol of allSymbols) {
      const klines = await fetchKlines(symbol);
      if (!klines || klines.length < 99) continue;

      const closes = klines.map(k => k.close);
      const price = closes.at(-1);
      const ema7 = EMA(closes, 7).at(-1);
      const ema25 = EMA(closes, 25).at(-1);
      const ema99 = EMA(closes, 99).at(-1);
      const rsi = RSI(closes);
      const macd = MACD(closes);

      const volumes = klines.map(k => k.volume);
      const avgVolume = volumes.slice(-20).reduce((a, b) => a + b) / 20;
      const currentVolume = volumes.at(-1);
      const isHighVolume = currentVolume > avgVolume * 1.05;

      const highs = klines.map(k => k.high);
      const lows = klines.map(k => k.low);
      const recentVolatility = highs.slice(-20).map((h, i) => h - lows.slice(-20)[i]);
      const avgVolatility = recentVolatility.reduce((a, b) => a + b) / 20;
      const isVolatile = avgVolatility > price * 0.005;

      const emaBullish = price > ema7 && ema7 > ema25 && ema25 > ema99;
      const emaBearish = price < ema7 && ema7 < ema25 && ema25 < ema99;
      const rsiBullish = rsi > 55;
      const rsiBearish = rsi < 45;
      const macdBullish = macd.histogram > 0;
      const macdBearish = macd.histogram < 0;

      let longMatch = 0;
      let shortMatch = 0;
      if (emaBullish) longMatch++;
      if (rsiBullish) longMatch++;
      if (macdBullish) longMatch++;
      if (isHighVolume) longMatch++;
      if (isVolatile) longMatch++;

      if (emaBearish) shortMatch++;
      if (rsiBearish) shortMatch++;
      if (macdBearish) shortMatch++;
      if (isHighVolume) shortMatch++;
      if (isVolatile) shortMatch++;

      let signal = "NO SIGNAL";
      let confidence = "LOW";

      if (longMatch >= 4) {
        signal = "LONG";
        confidence = longMatch === 5 ? "HIGH" : "MEDIUM";
      } else if (shortMatch >= 4) {
        signal = "SHORT";
        confidence = shortMatch === 5 ? "HIGH" : "MEDIUM";
      }

      if (signal !== "NO SIGNAL" && confidence === "HIGH") {
        const tp = (signal === "LONG" ? price * 1.03 : price * 0.97).toFixed(4);
        const sl = (signal === "LONG" ? price * 0.985 : price * 1.015).toFixed(4);
        signals += `
          <div style="margin-bottom:20px;">
            <b>üìä Symbol:</b> ${symbol}<br>
            <b>üö® SIGNAL:</b> <span style="color:${signal === "LONG" ? "#00ff00" : "#ff3333"}">${signal}</span><br>
            <b>üí∞ Entry:</b> ${price.toFixed(4)}<br>
            <b>‚≠ê TP:</b> ${tp}<br>
            <b>‚õî SL:</b> ${sl}<br>
            <b>‚öôÔ∏è Leverage:</b> 10‚Äì20x<br>
            <b>‚è±Ô∏è Timeframe:</b> 15m<br>
            <b>‚úÖ Confidence:</b> ${confidence}<br>
          </div>
        `;
      }
    }

    output.innerHTML = signals || "No high-confidence signals at the moment.";
  }

  loadSymbols();
  </script>
</body>
</html>
