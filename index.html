<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Futures Signal Generator</title>
  <style>
    body {
      background-color: black;
      font-family: monospace;
      color: lime;
      text-align: center;
      padding: 20px;
    }
    select, button {
      background: black;
      color: lime;
      border: 2px solid lime;
      padding: 10px;
      font-size: 18px;
      margin: 10px;
      border-radius: 8px;
    }
    .result {
      background-color: #111;
      border: 2px solid lime;
      border-radius: 16px;
      display: inline-block;
      padding: 20px;
      margin-top: 20px;
      box-shadow: 0 0 20px lime;
    }
  </style>
</head>
<body>
  <h1>Futures Signal Generator</h1>
  <select id="symbol">
    <option value="BTCUSDT">BTCUSDT</option>
    <option value="ETHUSDT">ETHUSDT</option>
    <option value="WCTUSDT">WCTUSDT</option>
  </select>
  <br />
  <button onclick="generateSignal()">Generate 15m Signal</button>

  <div id="output" class="result"></div>

  <script>
    async function fetchData(symbol) {
      const url = `https://api.binance.com/api/v3/klines?symbol=${symbol}&interval=15m&limit=100`;
      const response = await fetch(url);
      const data = await response.json();
      return data.map(candle => ({
        time: candle[0],
        open: parseFloat(candle[1]),
        high: parseFloat(candle[2]),
        low: parseFloat(candle[3]),
        close: parseFloat(candle[4]),
        volume: parseFloat(candle[5])
      }));
    }

    function ema(data, period) {
      const k = 2 / (period + 1);
      let emaArray = [];
      let emaPrev = data.slice(0, period).reduce((acc, d) => acc + d, 0) / period;
      emaArray[period - 1] = emaPrev;
      for (let i = period; i < data.length; i++) {
        emaPrev = data[i] * k + emaPrev * (1 - k);
        emaArray[i] = emaPrev;
      }
      return emaArray;
    }

    function rsi(data, period = 14) {
      let gains = 0, losses = 0;
      for (let i = 1; i <= period; i++) {
        const diff = data[i] - data[i - 1];
        if (diff >= 0) gains += diff;
        else losses -= diff;
      }
      gains /= period;
      losses /= period;
      let rs = gains / (losses || 1);
      let rsi = 100 - 100 / (1 + rs);
      return rsi;
    }

    function macdHistogram(data) {
      const ema12 = ema(data, 12);
      const ema26 = ema(data, 26);
      let histogram = [];
      for (let i = 0; i < data.length; i++) {
        if (ema12[i] && ema26[i]) {
          const macd = ema12[i] - ema26[i];
          const signal = ema(macd ? [macd] : [0], 9);
          histogram[i] = macd - (signal[signal.length - 1] || 0);
        }
      }
      return histogram;
    }

    function atr(data, period = 14) {
      let trs = [];
      for (let i = 1; i < data.length; i++) {
        const high = data[i].high;
        const low = data[i].low;
        const closePrev = data[i - 1].close;
        trs.push(Math.max(high - low, Math.abs(high - closePrev), Math.abs(low - closePrev)));
      }
      const atr = trs.slice(-period).reduce((a, b) => a + b, 0) / period;
      return atr;
    }

    async function generateSignal() {
      const symbol = document.getElementById("symbol").value;
      const data = await fetchData(symbol);
      const closes = data.map(d => d.close);
      const ema7 = ema(closes, 7).pop();
      const ema25 = ema(closes, 25).pop();
      const ema99 = ema(closes, 99).pop();
      const rsiVal = rsi(closes);
      const macdHist = macdHistogram(closes).pop();
      const atrVal = atr(data);
      const lastClose = closes[closes.length - 1];

      let signal = "";
      if (ema7 > ema25 && ema25 > ema99 && rsiVal > 55 && macdHist > 0) {
        signal = "LONG";
      } else if (ema7 < ema25 && ema25 < ema99 && rsiVal < 45 && macdHist < 0) {
        signal = "SHORT";
      } else {
        signal = "NEUTRAL";
      }

      const entry = parseFloat(lastClose.toFixed(4));
      const tp = parseFloat((signal === "LONG" ? entry * 1.03 : signal === "SHORT" ? entry * 0.97 : entry).toFixed(4));
      let sl;
      if (signal === "LONG") {
        sl = parseFloat((entry - Math.max(atrVal, entry - ema7)).toFixed(4));
      } else if (signal === "SHORT") {
        sl = parseFloat((entry + Math.max(atrVal, ema7 - entry)).toFixed(4));
      } else {
        sl = "-";
      }

      document.getElementById("output").innerHTML = `
        <div>
          <div>üìä <b>Symbol:</b> ${symbol}</div>
          <div>üö® <b>SIGNAL:</b> ${signal}</div>
          <div>üí∞ <b>Entry:</b> ${entry}</div>
          <div>‚≠ê <b>TP:</b> ${tp}</div>
          <div>‚õî <b>SL (Dynamic):</b> ${sl}</div>
          <div>‚öôÔ∏è <b>Leverage:</b> 10‚Äì20x</div>
          <div>‚è±Ô∏è <b>Timeframe:</b> 15m</div>
          <br/>
          <div>EMA7: ${ema7.toFixed(4)}</div>
          <div>EMA25: ${ema25.toFixed(4)}</div>
          <div>EMA99: ${ema99.toFixed(4)}</div>
          <div>RSI (14): ${rsiVal.toFixed(2)}</div>
          <div>MACD Histogram: ${macdHist.toFixed(5)}</div>
          <div>ATR(14): ${atrVal.toFixed(4)}</div>
        </div>
      `;
    }
  </script>
</body>
</html>
